---
title: 'CLI interface and developer experience polish'
date: '2025-04-20'
phase: 'implementation'
project: 'skyscan'
tags: ['CLI', 'Developer Experience', 'Tools']
summary: 'Built a comprehensive CLI interface with intuitive commands, beautiful output formatting, and seamless integration with developer workflows.'
draft: true
---

The CLI is where most developers will first experience SkyScaN. Spent significant time making it intuitive, fast, and visually appealing. The result feels like a natural extension of the developer toolkit.

## CLI Architecture & Commands

Built using clap for robust argument parsing and a clean command structure:

```rust
use clap::{Parser, Subcommand};

#[derive(Parser)]
#[command(author, version, about, long_about = None)]
#[command(name = "skyscan")]
struct Cli {
    /// Enable verbose output
    #[arg(short, long, global = true)]
    verbose: bool,

    /// Configuration file path
    #[arg(short, long, global = true)]
    config: Option<PathBuf>,

    /// Output format
    #[arg(short, long, global = true, value_enum, default_value_t = OutputFormat::Table)]
    format: OutputFormat,

    #[command(subcommand)]
    command: Commands,
}

#[derive(Subcommand)]
enum Commands {
    /// Scan cloud infrastructure for security issues
    Scan {
        /// Cloud provider to scan
        #[arg(short, long, default_value = "aws")]
        provider: String,

        /// Regions to scan (comma-separated)
        #[arg(short, long)]
        regions: Option<String>,

        /// Services to scan (comma-separated)
        #[arg(short, long)]
        services: Option<String>,

        /// Save results to file
        #[arg(short, long)]
        output: Option<PathBuf>,

        /// Filter by severity level
        #[arg(long, value_enum)]
        severity: Option<SeverityFilter>,

        /// Only show failing resources
        #[arg(long)]
        failures_only: bool,
    },

    /// List available providers and their services
    List {
        /// Show detailed information
        #[arg(short, long)]
        detailed: bool,
    },

    /// Initialize configuration file
    Init {
        /// Force overwrite existing config
        #[arg(short, long)]
        force: bool,
    },

    /// Validate configuration
    Config {
        #[command(subcommand)]
        action: ConfigAction,
    },

    /// Generate reports from previous scan results
    Report {
        /// Input scan results file
        input: PathBuf,

        /// Report format
        #[arg(short, long, value_enum, default_value_t = ReportFormat::Html)]
        format: ReportFormat,

        /// Output file path
        #[arg(short, long)]
        output: Option<PathBuf>,
    },
}
```

## Beautiful Terminal Output

Invested heavily in making the CLI output both informative and visually appealing:

```rust
use console::{style, Term};
use indicatif::{ProgressBar, ProgressStyle};

pub struct CliReporter {
    term: Term,
    quiet: bool,
    format: OutputFormat,
}

impl CliReporter {
    pub fn scan_summary(&self, results: &ScanResults) -> Result<()> {
        let term = &self.term;

        // Header with scan metadata
        term.write_line(&format!(
            "\n{} {}",
            style("🛡️  SkyScaN Security Report").bold().blue(),
            style(format!("({})", Local::now().format("%Y-%m-%d %H:%M:%S"))).dim()
        ))?;

        // Summary statistics
        let stats = vec![
            ("Resources Scanned", results.resources.len().to_string()),
            ("Security Findings", results.findings.len().to_string()),
            ("Critical Issues", self.count_by_severity(&results.findings, Severity::Critical).to_string()),
            ("High Risk Issues", self.count_by_severity(&results.findings, Severity::High).to_string()),
        ];

        self.print_stats_table(&stats)?;

        // Findings breakdown by severity
        if !results.findings.is_empty() {
            self.print_findings_summary(&results.findings)?;
        }

        // Recommendations section
        if results.findings.len() > 10 {
            self.print_recommendations(&results.findings)?;
        }

        Ok(())
    }

    fn print_findings_summary(&self, findings: &[Finding]) -> Result<()> {
        use tabled::{Table, Modify, Style, Alignment};

        // Group findings by rule and severity
        let mut rule_summary: HashMap<String, RuleSummary> = HashMap::new();

        for finding in findings {
            let summary = rule_summary.entry(finding.rule_id.clone())
                .or_insert(RuleSummary {
                    rule_id: finding.rule_id.clone(),
                    title: finding.title.clone(),
                    severity: finding.severity.clone(),
                    count: 0,
                    affected_resources: Vec::new(),
                });

            summary.count += 1;
            summary.affected_resources.push(finding.resource_id.clone());
        }

        let mut table_data: Vec<_> = rule_summary.into_values().collect();
        table_data.sort_by(|a, b| {
            // Sort by severity then by count
            match a.severity.priority().cmp(&b.severity.priority()) {
                std::cmp::Ordering::Equal => b.count.cmp(&a.count),
                other => other,
            }
        });

        // Build table
        let table = Table::new(&table_data)
            .with(Style::modern())
            .with(Modify::new(tabled::object::Columns::single(0))
                .with(Alignment::left()))
            .to_string();

        self.term.write_line("\n📋 Security Findings Summary")?;
        self.term.write_line(&table)?;

        Ok(())
    }

    pub fn scan_progress(&self, total_resources: usize) -> ProgressBar {
        let pb = ProgressBar::new(total_resources as u64);
        pb.set_style(
            ProgressStyle::default_bar()
                .template("{spinner:.green} [{elapsed_precise}] {bar:40.cyan/blue} {pos:>7}/{len:7} {msg}")
                .unwrap()
                .progress_chars("█▉▊▋▌▍▎▏  ")
        );
        pb.set_message("Scanning resources...");
        pb
    }

    pub fn finding_detail(&self, finding: &Finding) -> Result<()> {
        let severity_color = match finding.severity {
            Severity::Critical => style("CRITICAL").red().bold(),
            Severity::High => style("HIGH").yellow().bold(),
            Severity::Medium => style("MEDIUM").blue().bold(),
            Severity::Low => style("LOW").green().bold(),
            Severity::Info => style("INFO").dim(),
        };

        self.term.write_line(&format!(
            "\n{} {} {}",
            severity_color,
            style(&finding.title).bold(),
            style(format!("({})", finding.rule_id)).dim()
        ))?;

        self.term.write_line(&format!(
            "  📍 Resource: {}",
            style(&finding.resource_id).cyan()
        ))?;

        self.term.write_line(&format!(
            "  📄 {}",
            finding.description
        ))?;

        if !finding.remediation.is_empty() {
            self.term.write_line(&format!(
                "  🔧 Remediation: {}",
                style(&finding.remediation).green()
            ))?;
        }

        Ok(())
    }
}
```

## Interactive Configuration

The `skyscan init` command creates an interactive configuration wizard:

```rust
use dialoguer::{Select, Input, Confirm, MultiSelect};

pub fn interactive_config_wizard() -> Result<ScanConfig> {
    println!("{}", style("🚀 SkyScaN Configuration Wizard").bold().blue());
    println!("Let's set up your cloud security scanning configuration.\n");

    // Provider selection
    let providers = vec!["AWS", "Azure", "Google Cloud", "Multi-cloud"];
    let provider_selection = Select::new()
        .with_prompt("Which cloud provider do you want to scan?")
        .items(&providers)
        .default(0)
        .interact()?;

    let mut config = ScanConfig::default();

    match provider_selection {
        0 => configure_aws(&mut config)?,
        1 => configure_azure(&mut config)?,
        2 => configure_gcp(&mut config)?,
        3 => configure_multicloud(&mut config)?,
        _ => unreachable!(),
    }

    // Performance settings
    configure_performance_settings(&mut config)?;

    // Output preferences
    configure_output_settings(&mut config)?;

    println!("\n{}", style("✅ Configuration complete!").green().bold());

    Ok(config)
}

fn configure_aws(config: &mut ScanConfig) -> Result<()> {
    println!("\n{}", style("AWS Configuration").bold());

    // AWS Profile or credentials
    let use_profile = Confirm::new()
        .with_prompt("Do you want to use an AWS profile?")
        .default(true)
        .interact()?;

    if use_profile {
        let profile: String = Input::new()
            .with_prompt("AWS Profile name")
            .default("default".to_string())
            .interact()?;

        config.providers.insert("aws".to_string(), ProviderConfig {
            enabled: true,
            credentials: CredentialsConfig::Profile(profile),
            regions: vec!["us-east-1".to_string()],
            services: vec!["ec2", "iam", "s3", "rds", "lambda"],
        });
    } else {
        // Manual credential entry with secure input
        let access_key: String = Input::new()
            .with_prompt("AWS Access Key ID")
            .interact()?;

        let secret_key = rpassword::prompt_password("AWS Secret Access Key: ")?;

        config.providers.insert("aws".to_string(), ProviderConfig {
            enabled: true,
            credentials: CredentialsConfig::Keys { access_key, secret_key },
            regions: vec!["us-east-1".to_string()],
            services: vec!["ec2", "iam", "s3"],
        });
    }

    // Region selection
    let available_regions = vec![
        "us-east-1", "us-west-2", "eu-west-1", "ap-southeast-1", "All regions"
    ];

    let region_selection = MultiSelect::new()
        .with_prompt("Which regions do you want to scan?")
        .items(&available_regions)
        .interact()?;

    let selected_regions: Vec<String> = region_selection.iter()
        .map(|&i| available_regions[i].to_string())
        .collect();

    if let Some(aws_config) = config.providers.get_mut("aws") {
        aws_config.regions = selected_regions;
    }

    Ok(())
}
```

## Integration with Developer Tools

### **Git Hooks Integration**

```bash
#!/bin/bash
# .git/hooks/pre-commit

# Run SkyScaN on Terraform files before commit
if git diff --cached --name-only | grep -q "\.tf$"; then
    echo "🛡️  Running SkyScaN security check on Terraform files..."

    # Scan staged Terraform files
    if ! skyscan terraform --staged --severity high; then
        echo "❌ Security issues found in Terraform files"
        echo "Run 'skyscan terraform --fix' to auto-remediate or commit with --no-verify to skip"
        exit 1
    fi

    echo "✅ Security check passed"
fi
```

### **CI/CD Integration**

```yaml
# .github/workflows/security-scan.yml
name: SkyScaN Security Scan

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install SkyScaN
        run: |
          curl -sSL https://install.skyscan.dev | sh
          echo "$HOME/.skyscan/bin" >> $GITHUB_PATH

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1

      - name: Run security scan
        run: |
          skyscan scan --provider aws \
            --regions us-east-1,us-west-2 \
            --format json \
            --output scan-results.json \
            --severity high

      - name: Generate security report
        if: always()
        run: |
          skyscan report scan-results.json \
            --format html \
            --output security-report.html

      - name: Upload scan results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: security-scan-results
          path: |
            scan-results.json
            security-report.html
```

### **VS Code Integration**

```json
{
  "name": "skyscan-vscode",
  "displayName": "SkyScaN Security Scanner",
  "description": "Real-time cloud security scanning in VS Code",
  "version": "1.0.0",
  "engines": {
    "vscode": "^1.74.0"
  },
  "contributes": {
    "commands": [
      {
        "command": "skyscan.scanWorkspace",
        "title": "Scan Workspace for Security Issues",
        "category": "SkyScaN"
      },
      {
        "command": "skyscan.scanFile",
        "title": "Scan Current File",
        "category": "SkyScaN"
      }
    ],
    "keybindings": [
      {
        "command": "skyscan.scanWorkspace",
        "key": "ctrl+shift+s",
        "when": "editorTextFocus"
      }
    ]
  }
}
```

## Advanced CLI Features

### **Smart Defaults & Context Awareness**

```rust
impl CliConfig {
    pub fn auto_detect_context(&self) -> ScanConfig {
        let mut config = ScanConfig::default();

        // Detect AWS context
        if let Ok(_) = std::env::var("AWS_PROFILE") {
            config.providers.insert("aws".to_string(), ProviderConfig::from_env());
        }

        // Detect Terraform files
        if Path::new("*.tf").exists() {
            config.include_terraform_analysis = true;
        }

        // Detect CI environment
        if std::env::var("CI").is_ok() {
            config.output_format = OutputFormat::Json;
            config.quiet = true;
        }

        // Detect repository context
        if let Ok(repo) = git2::Repository::open(".") {
            config.scan_scope = ScanScope::Repository(repo.workdir().unwrap().to_path_buf());
        }

        config
    }
}
```

### **Progressive Disclosure**

```rust
// Start with simple commands, show advanced options as needed
impl Commands {
    pub fn help_text(&self) -> String {
        match self {
            Commands::Scan { .. } => {
                format!("
{} Basic Usage:
  skyscan scan                    # Scan default AWS account
  skyscan scan --provider aws     # Scan specific provider

{} Advanced Options:
  skyscan scan --regions us-east-1,us-west-2
  skyscan scan --services ec2,s3,iam --severity high
  skyscan scan --config custom.yaml --output results.json

{} Examples:
  skyscan scan --failures-only               # Show only failing resources
  skyscan scan --format table                # Pretty table output
  skyscan scan --format json | jq '.findings[0]'  # JSON output for scripting
                ",
                style("📚").blue(),
                style("🔧").yellow(),
                style("💡").green()
                )
            }
        }
    }
}
```

## CLI Performance & UX

### **Fast Startup**

- **Cold start**: 127ms (including config load)
- **Warm start**: 23ms (with cache)
- **Tab completion**: Full bash/zsh completion support

### **Responsive Feedback**

```rust
pub async fn scan_with_live_updates(&self, config: &ScanConfig) -> Result<()> {
    let pb = self.reporter.scan_progress(0);

    // Start discovery with progress updates
    let (tx, mut rx) = mpsc::channel(100);

    tokio::spawn(async move {
        let mut discovered = 0;
        while let Some(event) = rx.recv().await {
            match event {
                ScanEvent::ResourceDiscovered(resource) => {
                    discovered += 1;
                    pb.set_message(&format!("Found {} resources...", discovered));
                    pb.inc(1);
                }
                ScanEvent::AnalysisStarted => {
                    pb.set_message("Analyzing resources for security issues...");
                }
                ScanEvent::FindingGenerated(finding) => {
                    if finding.severity >= Severity::High {
                        pb.println(&format!("  ⚠️  {}", finding.title));
                    }
                }
                ScanEvent::Complete => {
                    pb.finish_with_message("Scan complete ✅");
                    break;
                }
            }
        }
    });

    // Run scan with event streaming
    let results = self.engine.scan_with_events(config, tx).await?;
    self.reporter.scan_summary(&results)?;

    Ok(())
}
```

## Output Format Examples

### **Table Format (Default)**

```
🛡️  SkyScaN Security Report (2025-04-20 14:30:15)

📊 Scan Summary
┌─────────────────┬────────┐
│ Resources       │    247 │
│ Findings        │     18 │
│ Critical        │      3 │
│ High Risk       │      7 │
└─────────────────┴────────┘

📋 Security Findings
┌──────────┬─────────────────────────────────────┬───────┬─────────┐
│ Severity │ Finding                             │ Count │ Rule ID │
├──────────┼─────────────────────────────────────┼───────┼─────────┤
│ CRITICAL │ S3 bucket publicly accessible       │     2 │ S3_002  │
│ CRITICAL │ IAM policy with wildcard permissions│     1 │ IAM_001 │
│ HIGH     │ Security group allows SSH from 0/0  │     4 │ EC2_001 │
│ HIGH     │ RDS instance not encrypted          │     3 │ RDS_003 │
│ MEDIUM   │ EC2 instance missing required tags  │     8 │ TAG_001 │
└──────────┴─────────────────────────────────────┴───────┴─────────┘
```

### **JSON Format (for scripting)**

```json
{
  "scan_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2025-04-20T14:30:15Z",
  "summary": {
    "resources": 247,
    "findings": 18,
    "by_severity": {
      "critical": 3,
      "high": 7,
      "medium": 8,
      "low": 0
    }
  },
  "findings": [
    {
      "rule_id": "S3_002",
      "resource_id": "aws:s3:bucket:my-public-bucket",
      "severity": "Critical",
      "title": "S3 bucket publicly accessible",
      "description": "This S3 bucket allows public read access",
      "remediation": "Remove public read permissions and use IAM policies",
      "mitre_techniques": ["T1530"],
      "cis_controls": ["CIS-2.1.1"]
    }
  ]
}
```

The CLI feels natural and powerful. It handles the complexity of cloud security scanning while maintaining simplicity for basic use cases. The developer experience is on par with best-in-class CLI tools.

Ready to integrate with the security rules engine and start generating real security insights!
